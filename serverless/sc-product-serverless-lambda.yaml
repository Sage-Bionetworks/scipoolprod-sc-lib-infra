---
AWSTemplateFormatVersion: '2010-09-09'
Description: AWS Lambda Service Catalog product (fdp-1p5rtpgls)
Parameters:
  PortfolioProvider:
    Type: String
    Description: Owner and Distributor Name
  LaunchConstraintARN:
    Type: String
    Description: ARN of the launch constraint role for EC2 products.
  PortfolioId:
    Type: String
    Description: The ServiceCatalog portfolio this product will be attached to.
  RepoRootURL:
    Type: String
    Description: Root url for the repo containing the product templates.
Resources:
  lambdaproduct:
    Type: AWS::ServiceCatalog::CloudFormationProduct
    Metadata:
      cfn-lint:
        config:
          ignore_checks:
            - E3002
    Properties:
      Name: Amazon Lambda APIGateway Endpoint
      Description: This product builds one Amazon Lambda function and APIGateway endpoint
      Owner:
        Ref: PortfolioProvider
      Distributor:
        Ref: PortfolioProvider
      ProvisioningArtifactParameters:
      - Description: baseline version
        Info:
          LoadTemplateFromURL:
            Fn::Sub: "${RepoRootURL}serverless/sc-serverless-lambda.yaml"
        Name: v1.2
      'Fn::Transform':
        Name: 'AWS::Include'
        Parameters:
          Location : "s3://cfn-snippets-bucket-cloudformationsnippetsbucket-elu83sv8ocdz/scipoolprod-sc-lib-infra/support.yaml"
  Associatelambda:
    Type: AWS::ServiceCatalog::PortfolioProductAssociation
    Properties:
      PortfolioId:
        Ref: PortfolioId
      ProductId:
        Ref: lambdaproduct
  constraintlambda:
    Type: AWS::ServiceCatalog::LaunchRoleConstraint
    DependsOn: Associatelambda
    Properties:
      PortfolioId:
        Ref: PortfolioId
      ProductId:
        Ref: lambdaproduct
      RoleArn:
        Ref: LaunchConstraintARN
      Description:
        Ref: LaunchConstraintARN
Outputs:
  ProductId:
    Value:
      Ref: lambdaproduct
  ProvisioningArtifactIds:
    Value:
      Fn::GetAtt:
      - lambdaproduct
      - ProvisioningArtifactIds
  ProvisioningArtifactNames:
    Value:
      Fn::GetAtt:
      - lambdaproduct
      - ProvisioningArtifactNames
